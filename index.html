<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For Jay ‚Äî From Shubhu ‚ù§Ô∏è</title>
<meta name="description" content="A little interactive love site made by Shubhu for Jayu" />
<script>
  const IMAGE_MEMORY = "memory1.jpg";
  const IMAGE_UDAIPUR = "udaipur.jpg";
  const NICK_SHUBHU = "Shubhu";
  const NICK_JAYU = "Jayu";
</script>

<style>
:root{
  --bg1:#fff6f9; --panel:#ffffff; --accent1:#ff7aa5; --accent2:#ffc2d9;
  --muted:#6b656b; --soft-shadow:0 18px 48px rgba(160,80,120,0.08);
  --glass: rgba(255,255,255,0.85);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#fff7f9 0%,#fff2f7 100%);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Helvetica Neue",Arial;color:#2f2329;-webkit-font-smoothing:antialiased}
.wrap{max-width:1000px;margin:28px auto;padding:18px;background:var(--panel);border-radius:26px;box-shadow:var(--soft-shadow);overflow:hidden}
.header{display:flex;align-items:center;justify-content:space-between;padding:14px}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:60px;height:60px;border-radius:14px;background:linear-gradient(180deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:26px}
.title{font-weight:800;font-size:18px}
.subtitle{font-size:13px;color:var(--muted)}
.tip{color:var(--muted);font-size:14px}

/* pages */
.page{display:none;opacity:0;transform:translateY(14px);transition:all .5s}
.page.active{display:block;opacity:1;transform:none}
.stage{min-height:66vh;display:flex;flex-direction:column;gap:18px;align-items:center;padding:28px}

/* meters */
.meter{width:100%;max-width:760px;background:linear-gradient(180deg,#fff,#fffaf6);border-radius:12px;padding:8px;border:1px solid rgba(0,0,0,0.04)}
.meter-bar{height:16px;background:linear-gradient(90deg,var(--accent1),var(--accent2));border-radius:10px;width:0%;transition:width .6s}

/* grids */
.hearts-area{width:360px;height:300px;border-radius:14px;background:linear-gradient(180deg,#fff4f8,#fff9fb);display:flex;flex-wrap:wrap;gap:10px;padding:12px;align-content:flex-start}
.heart{width:66px;height:66px;border-radius:14px;background:linear-gradient(90deg,#ffdfea,#ffb7d6);display:flex;align-items:center;justify-content:center;font-size:26px;color:white}
.flower-area{width:360px;height:360px;border-radius:14px;background:linear-gradient(180deg,#fffaf6,#fff6fb);overflow:hidden;padding:12px;display:flex;flex-wrap:wrap;align-content:flex-start}
.flower{width:56px;height:56px;border-radius:12px;background:linear-gradient(90deg,#fff0f6,#ffdff0);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:opacity .2s, transform .12s}
.flower.collected{opacity:.28;transform:scale(.88);pointer-events:none}

/* path */
.path-area{width:92%;max-width:820px;height:320px;border-radius:16px;background:linear-gradient(180deg,#fff,#fffaf6);display:flex;align-items:center;justify-content:center;padding:20px}
.path-line{width:88%;height:8px;background:repeating-linear-gradient(90deg,#ffd7e5 0 12px, transparent 12px 24px);border-radius:12px;position:relative}
.checkpoint{position:absolute;top:-30px;transform:translateX(-50%);background:var(--glass);padding:8px 12px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 12px 36px rgba(170,90,130,0.05);cursor:pointer;transition:all .2s}
.checkpoint.unlocked{transform:translateX(-50%) scale(1.03);box-shadow:0 18px 48px rgba(200,100,140,0.06);pointer-events:auto}

/* letter */
.letter-area{width:100%;max-width:760px;border-radius:12px;padding:20px;background:linear-gradient(180deg,#fff,#fff9fb);border:1px dashed rgba(255,107,154,0.06)}

/* map */
.map-area{width:100%;max-width:900px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#fff,#fff6fb)}

/* modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(20,15,20,0.06);display:flex;align-items:center;justify-content:center;z-index:9999}
.modal{width:92%;max-width:780px;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.96));padding:20px;border-radius:16px}
.modal h3{margin:0 0 8px}
.modal .muted{color:var(--muted)}

/* gallery messages */
.gallery-message{width:360px;height:260px;border-radius:14px;background:linear-gradient(180deg,#fff,#fff6fb);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;padding:18px;text-align:center;box-shadow:0 14px 36px rgba(200,120,160,0.04)}
.gallery-message.small{font-size:16px}

/* future cards */
.future-grid{width:92%;max-width:920px;display:flex;gap:18px;flex-wrap:nowrap;overflow-x:auto;padding:12px}
.future-card{min-width:260px;border-radius:14px;padding:18px;background:linear-gradient(180deg,#fff,#fff8fb);box-shadow:0 14px 36px rgba(200,120,160,0.04);display:flex;flex-direction:column;gap:12px;align-items:flex-start;transform:translateY(20px);opacity:0;transition:all .5s}
.future-card.visible{transform:none;opacity:1}
.future-icon{width:56px;height:56px;border-radius:12px;background:linear-gradient(90deg,#ffdff0,#fff0f6);display:flex;align-items:center;justify-content:center;font-size:24px}

/* spinner */
.spinner{width:56px;height:56px;border-radius:50%;border:5px solid rgba(255,107,154,0.12);border-top-color:var(--accent1);animation:spin 1.2s linear infinite;margin:18px auto}
@keyframes spin{to{transform:rotate(360deg)}}

/* buttons */
.btn-primary{cursor:pointer;border:0;border-radius:12px;padding:10px 16px;font-weight:700;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white}
.btn-light{cursor:pointer;border-radius:12px;padding:8px 12px;background:transparent;border:1px solid rgba(255,107,154,0.12);color:var(--accent1);font-weight:700}
.muted{color:var(--muted)}
.tiny{font-size:13px;color:var(--muted)}

footer{margin-top:18px;padding:14px;text-align:center;font-size:13px;color:var(--muted)}
@media (max-width:820px){ .gallery-message{width:260px;height:180px} .wrap{margin:12px;padding:12px} .future-card{min-width:200px} }
</style>
</head>
<body>
  <div id="floatingHeartBg" aria-hidden="true"></div>

  <div class="wrap" role="main" aria-label="For Jay site">
    <div class="header">
      <div class="brand">
        <div class="logo">üíó</div>
        <div>
          <div class="title">A little corner for <strong id="nick-jayu">Jayu</strong></div>
          <div class="subtitle">Made with love by <strong id="nick-shubhu">Shubhu</strong></div>
        </div>
      </div>
      <div class="tip">Shubhu ka attitude, Jayu ke liye mute.</div>
    </div>

    <!-- Welcome modal -->
    <div id="welcomeModal" class="modal-backdrop" role="dialog" aria-modal="true" style="display:flex">
      <div class="modal" style="text-align:center">
        <h3>Hey Jayu ‚Äî a tiny rule from your baby</h3>
        <p class="muted">Tap to accept your job as the official pamperer.</p>
        <div style="display:flex;justify-content:center;margin-top:12px">
          <button class="btn-primary" id="welcomeAccept">Okay boss-baby üíó</button>
        </div>
      </div>
    </div>

    <!-- Stage 1 -->
    <section id="page1" class="page active">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Stage 1 ‚Äî Tap hearts (0 ‚Üí 25%)</h1>
        <div class="meter"><div class="meter-bar" id="meter1" style="width:0%"></div></div>
        <div class="hearts-area" id="heartsArea" aria-label="tap hearts" role="region"></div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center">
          <button class="btn-light" id="page1Skip" disabled>Next (locked)</button>
          <div class="tiny muted">Tap hearts to fill the meter ‚Äî no skipping!</div>
        </div>
      </div>
    </section>

    <!-- Stage 2 -->
    <section id="page2" class="page">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Stage 2 ‚Äî Catch flowers (25 ‚Üí 50%)</h1>
        <div class="meter"><div class="meter-bar" id="meter2" style="width:25%"></div></div>
        <div class="flower-area" id="flowerArea" aria-label="catch flowers"></div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center">
          <button class="btn-light" id="page2Letter" disabled>Open Mini Letter</button>
          <div class="tiny muted">Collect flowers to unlock the letter</div>
        </div>
      </div>
    </section>

    <!-- Stage 3 -->
    <section id="page3" class="page">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Stage 3 ‚Äî Follow our tiny path (50 ‚Üí 75%)</h1>
        <div class="path-area"><div class="path-line" id="pathLine" role="img" aria-label="path checkpoints"></div></div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center;margin-top:12px">
          <button class="btn-light" id="openGallery" disabled>View Memory Snaps</button>
          <div class="tiny muted">Tap each checkpoint ‚Äî don‚Äôt skip steps, Jayu!</div>
        </div>

        <div style="margin-top:16px; display:flex; gap:12px; align-items:center; justify-content:center;">
          <button class="btn-primary" id="page3Next" disabled>Next ‚Üí Stage 4</button>
        </div>
      </div>
    </section>

    <!-- Stage 4 -->
    <section id="page4" class="page">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Stage 4 ‚Äî A line-by-line letter (75 ‚Üí 100%)</h1>
        <div class="meter"><div class="meter-bar" id="meter4" style="width:75%"></div></div>
        <div class="letter-area" id="letterArea">
          <p id="letterTextPreview" class="muted">Tap each tiny heart to reveal the next line of my letter.</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px" id="letterHearts"></div>
        </div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center;margin-top:10px">
          <button class="btn-primary" id="finishLetter" disabled>Open Final Surprise</button>
          <div class="tiny muted">Reveal the full letter to continue</div>
        </div>
      </div>
    </section>

    <!-- Page: Journey Map -->
    <section id="pageMap" class="page">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Journey Map ‚Äî Tap each stop</h1>
        <p class="muted">Tap each stop in order. After you answer Stop 5, the future stops will unlock.</p>
        <div class="map-area" id="mapArea" aria-live="polite">
          <div class="map-row locked" data-stop="1" id="stop-1"><div style="font-weight:700">2005‚Äì06 ‚Äî GIPCL School, Gujarat</div></div>
          <div class="map-row locked" data-stop="2" id="stop-2"><div style="font-weight:700">Bench partners ‚Üí IG reunion (2017)</div></div>
          <div class="map-row locked" data-stop="3" id="stop-3"><div style="font-weight:700">2019 ‚Äî Shubhu proposed first</div></div>
          <div class="map-row locked" data-stop="4" id="stop-4"><div style="font-weight:700">2019‚Äì2025 ‚Äî Long distance</div></div>
          <div class="map-row locked" data-stop="5" id="stop-5"><div style="font-weight:700">Your favourite memory</div><div style="margin-top:10px"><button class="btn-light" id="openMemoryBox">Tell memory</button></div></div>

          <div id="futureStops" style="display:none; margin-top:12px;">
            <div class="map-row locked" data-stop="A" id="stop-A"><div style="font-weight:700">Udaipur ‚Äî Our romantic trip</div></div>
            <!-- more future stops omitted for brevity -->
          </div>
        </div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center;margin-top:12px">
          <button class="btn-primary" id="mapFinish" disabled>Finish Journey ‚Üí</button>
        </div>
      </div>
    </section>

    <!-- Memory modal -->
    <div id="memoryModal" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal">
        <h3>Jayu ‚Äî your favourite memory</h3>
        <p class="muted tiny">Type one memory you love most. This saves locally on your device.</p>
        <textarea id="memoryInput" rows="4" placeholder="Type your memory..." style="width:100%;border-radius:10px;padding:10px;border:1px solid rgba(0,0,0,0.06)"></textarea>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
          <button class="btn-light" id="memoryCancel">Cancel</button>
          <button class="btn-primary" id="memorySave">Save memory</button>
        </div>
      </div>
    </div>

    <!-- Gallery (messages only) -->
    <div id="galleryModal" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal" style="max-width:980px">
        <h3>Memory Snaps</h3>
        <div id="galleryLoader" style="display:block;text-align:center">
          <div class="spinner" aria-hidden="true"></div>
          <div class="muted tiny">Preparing sweet notes‚Ä¶</div>
        </div>

        <div id="galleryBody" style="display:none">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
            <div style="display:flex;gap:14px;align-items:flex-start">
              <div class="gallery-message" id="slideMsg1" role="img" aria-label="message slide 1"></div>
              <div class="gallery-message small" id="slideMsg2" role="img" aria-label="message slide 2" style="display:none"></div>
            </div>

            <div style="display:flex;flex-direction:column;gap:10px;align-items:center">
              <div style="display:flex;gap:8px">
                <button class="btn-light" id="prevSlide">Prev</button>
                <button class="btn-light" id="nextSlide">Next</button>
              </div>
              <div class="tiny muted">Auto-advances ‚Äî but you can control it</div>
            </div>
          </div>

          <div style="display:flex;justify-content:flex-end;margin-top:12px">
            <button class="btn-light" id="galleryClose">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Final page -->
    <section id="pageFinal" class="page">
      <div class="stage" style="align-items:center;justify-content:center">
        <h1 style="font-size:32px;font-weight:800">Close your eyes and smile, Jayu‚Ä¶</h1>
        <p class="muted" style="max-width:720px;text-align:center">Imagine every version of us ‚Äî school kids, long-distance fools, and old home-makers ‚Äî and smile. In every timeline, I choose you.</p>
        <div class="big-heart" id="bigHeart" style="width:220px;height:220px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #ffb0c9, #ff5a8a);margin:20px auto;box-shadow:0 30px 80px rgba(255,90,140,0.12)"></div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center;margin-top:8px">
          <button class="btn-primary" id="hugBtn">Hug Shubhu ü§ç</button>
          <button class="btn-light" id="seeFutureBtn">See Our Future ‚Üí</button>
        </div>
      </div>
    </section>

    <!-- NEW: Future Life page -->
    <section id="pageFuture" class="page">
      <div class="stage" style="align-items:flex-start">
        <h1 style="font-size:30px;font-weight:800">Our Future ‚Äî little chapters</h1>
        <p class="muted">A playful peek ahead. Swipe or scroll right to left.</p>

        <div class="future-grid" id="futureGrid" aria-live="polite">
          <!-- cards will be populated by JS for easy editing -->
        </div>

        <div style="display:flex;gap:12px;align-items:center;justify-content:center;margin-top:18px">
          <button class="btn-light" id="backToStart">Back to Start</button>
          <button class="btn-primary" id="finishFuture">Love you ‚Äî finish</button>
        </div>
      </div>
    </section>

    <footer>Made with love by <strong id="footerShubhu">Shubhu</strong> üíó</footer>
  </div>

<script>
/* helper */
const $ = id => document.getElementById(id);

/* fill nicknames */
if($('nick-jayu')) $('nick-jayu').textContent = (typeof NICK_JAYU!=='undefined') ? NICK_JAYU : 'Jayu';
if($('nick-shubhu')) $('nick-shubhu').textContent = (typeof NICK_SHUBHU!=='undefined') ? NICK_SHUBHU : 'Shubhu';
if($('footerShubhu')) $('footerShubhu').textContent = (typeof NICK_SHUBHU!=='undefined') ? NICK_SHUBHU : 'Shubhu';

/* simple modal */
function showInfoModal(title, body, cb){
  const m = $('infoModal') || null;
  if(!m){
    alert(title + "\n\n" + body);
    if(cb) cb();
    return;
  }
  $('infoTitle').textContent = title; $('infoBody').textContent = body;
  m.style.display='flex'; m.setAttribute('aria-hidden','false');
  const ok = $('infoOk');
  ok.onclick = ()=> { m.style.display='none'; m.setAttribute('aria-hidden','true'); if(cb) cb(); };
  ok.focus && ok.focus();
}

/* welcome */
if($('welcomeAccept')) $('welcomeAccept').addEventListener('click', ()=> { const w = $('welcomeModal'); if(w){ w.style.display='none'; w.setAttribute('aria-hidden','true'); } });

/* Stage 1 hearts */
const meter1 = $('meter1'), heartsArea = $('heartsArea');
let progress1 = 0, target1 = 25;
function createHearts(){
  if(!heartsArea) return;
  heartsArea.innerHTML='';
  for(let i=0;i<12;i++){
    const d = document.createElement('div'); d.className='heart'; d.textContent='üíó';
    d.addEventListener('click', ()=> {
      if(progress1 >= target1) return;
      progress1 += Math.floor(Math.random()*3)+1;
      if(progress1>target1) progress1=target1;
      if(meter1) meter1.style.width = progress1 + '%';
      d.style.transform='scale(.96)'; setTimeout(()=> d.style.transform='',140);
      if(progress1 >= target1){
        const btn = $('page1Skip'); if(btn){ btn.disabled=false; btn.onclick = ()=> { showPage('page2'); btn.disabled=true; } }
      }
    });
    heartsArea.appendChild(d);
  }
}
createHearts();

/* Stage 2 flowers */
const flowerArea = $('flowerArea');
let progress2 = 25, target2 = 50, miniLetterOpened = false;
function createFlowers(){
  if(!flowerArea) return;
  flowerArea.innerHTML='';
  const tileCount = 18;
  for(let i=0;i<tileCount;i++){
    const f = document.createElement('div'); f.className='flower';
    const icons=['üå∏','‚öΩ','üéÆ','üöó']; f.textContent = icons[Math.floor(Math.random()*icons.length)];
    f.addEventListener('click', ()=> {
      if(progress2 >= target2) return;
      progress2 += 2; if(progress2>target2) progress2=target2;
      f.classList.add('collected');
      const m2 = $('meter2'); if(m2) m2.style.width = progress2 + '%';
      checkStage2();
    });
    flowerArea.appendChild(f);
  }
}
function checkStage2(){
  const btn = $('page2Letter');
  if(progress2 >= target2){
    if(btn){
      btn.disabled=false;
      if(!btn._attached){
        btn._attached=true;
        btn.addEventListener('click', ()=> { showInfoModal("Mini letter from "+(typeof NICK_SHUBHU!=='undefined'?NICK_SHUBHU:'Shubhu'), "Halfway, and I kept choosing you.", ()=> showPage('page3')); });
      }
      try{ btn.focus(); }catch(e){}
    }
    if(!miniLetterOpened){
      miniLetterOpened=true;
      document.querySelectorAll('.flower').forEach(fl=>{ fl.classList.add('collected'); fl.style.pointerEvents='none'; });
      setTimeout(()=> {
        showInfoModal("Mini letter from "+(typeof NICK_SHUBHU!=='undefined'?NICK_SHUBHU:'Shubhu'), "Halfway, and I kept choosing you.", ()=> showPage('page3'));
      }, 240);
    }
  } else { if(btn) btn.disabled=true; }
}
createFlowers();

/* Stage 3 path & buttons */
const pathLine = $('pathLine');
let checkpointCount = 0;
const checkpoints = [
  {x:8, label:"We learned to trust."},
  {x:30, label:"We learned to stay."},
  {x:54, label:"We learned to love deeper."},
  {x:80, label:"We chose each other."}
];

function buildPath(){
  if(!pathLine) return;
  pathLine.innerHTML='';
  checkpoints.forEach((cp,i)=>{
    const el = document.createElement('div'); el.className='checkpoint locked';
    el.style.left = cp.x + '%'; el.id = 'cp-'+i;
    el.innerHTML = `<div style="font-weight:700">‚Ä¢</div><div class="muted tiny">${cp.label}</div>`;
    el.addEventListener('click', ()=> {
      if(i>checkpointCount){ showInfoModal("Slow down, Jayu","Follow the path in order ‚Äî one step at a time üòä"); return; }
      el.classList.remove('locked'); el.classList.add('unlocked');
      showInfoModal("Memory unlocked", cp.label);
      checkpointCount++;
      const percent = 50 + Math.floor((checkpointCount / checkpoints.length) * 25);
      const m2 = $('meter2'); if(m2) m2.style.width = percent + '%';

      if(checkpointCount === checkpoints.length){
        // enable gallery
        const openG = $('openGallery');
        if(openG){
          openG.disabled=false; openG.setAttribute('aria-disabled','false');
          if(!openG._attachedGalleryHandler){
            openG._attachedGalleryHandler = true;
            openG.addEventListener('click', (ev)=>{ ev && ev.preventDefault(); openGalleryWithLoader(); });
          }
          try{ openG.focus(); }catch(e){}
        }
        // enable next visible CTA
        const nextBtn = $('page3Next');
        if(nextBtn){
          nextBtn.disabled=false;
          if(!nextBtn._attached){
            nextBtn._attached=true;
            nextBtn.addEventListener('click', ()=> { showPage('page4'); });
          }
        }
      }
    });
    pathLine.appendChild(el);
  });
}
buildPath();

/* Stage 4: letter reveal */
const letterLines = [
  "Even when the world was loud,",
  "I kept hearing your quiet laugh.",
  "Even when miles stretched long,",
  "You were the place I came home to.",
  "You are my calm and my chaos.",
  "I choose you ‚Äî again and again."
];
let revealed = 0;
const letterHearts = $('letterHearts');

function buildLetterHearts(){
  if(!letterHearts) return;
  letterHearts.innerHTML='';
  for(let i=0;i<letterLines.length;i++){
    const h = document.createElement('div'); h.className='heart'; h.textContent='üíó';
    h.addEventListener('click', ()=> {
      if(h.dataset.revealed==='true') return;
      showInfoModal("Letter line", letterLines[i], ()=> {
        const p = document.createElement('div'); p.style.marginTop='8px'; p.style.fontWeight='600'; p.textContent = letterLines[i];
        const area = $('letterArea'); if(area) area.insertBefore(p, letterHearts);
        h.dataset.revealed='true'; revealed++;
        const m4 = $('meter4'); const percent = 75 + Math.floor((revealed/letterLines.length)*25);
        if(m4) m4.style.width = percent + '%';
        if(revealed === letterLines.length){
          const finish = $('finishLetter');
          if(finish){ finish.disabled=false; finish.onclick = ()=> { showPage('pageMap'); unlockMapStop(1); } }
        }
      });
    });
    letterHearts.appendChild(h);
  }
}
buildLetterHearts();

/* Journey map */
function unlockMapStop(n){
  let el=null;
  if(typeof n==='number' && n>0 && n<=5) el = $('stop-'+n);
  else el = document.querySelector(`[data-stop='${n}']`);
  if(!el) return;
  el.classList.remove('locked'); el.classList.add('unlocked');
}
['stop-1','stop-2','stop-3','stop-4'].forEach(id=>{
  const el = $(id); if(!el) return;
  el.addEventListener('click', ()=> {
    if(el.classList.contains('locked')){ showInfoModal("Locked","Complete previous steps to unlock this stop, Jayu."); return; }
    const title = el.textContent || 'Stop';
    showInfoModal(title, 'Nice memory', ()=> { const next = parseInt(id.split('-')[1]) + 1; if($('stop-'+next)) unlockMapStop(next); });
  });
});

/* Stop 5 memory box */
if($('openMemoryBox')) $('openMemoryBox').addEventListener('click', ()=> { const mm=$('memoryModal'); if(!mm) return; mm.style.display='flex'; mm.setAttribute('aria-hidden','false'); const saved = localStorage.getItem('favMemory'); if(saved && $('memoryInput')) $('memoryInput').value = saved; });
if($('memoryCancel')) $('memoryCancel').addEventListener('click', ()=> { const mm=$('memoryModal'); if(mm){ mm.style.display='none'; mm.setAttribute('aria-hidden','true'); } });
if($('memorySave')) $('memorySave').addEventListener('click', ()=> {
  const el = $('memoryInput'); if(!el) return; const val = el.value.trim();
  if(!val){ showInfoModal("Aww","Please share one memory, Jayu ‚Äî your Shubhu is waiting!"); return; }
  localStorage.setItem('favMemory', val);
  const mm = $('memoryModal'); if(mm){ mm.style.display='none'; mm.setAttribute('aria-hidden','true'); }
  showInfoModal("Saved","Memory saved. Thank you, Jayu üíó", ()=> { const future = $('futureStops'); if(future) future.style.display='flex'; unlockFutureStopsInOrder(0); });
});

const futureList = ['A','B','C','D','E','F','G','H','K'];
function unlockFutureStopsInOrder(idx){
  if(idx >= futureList.length){ const mf = $('mapFinish'); if(mf) mf.disabled=false; return; }
  const code = futureList[idx]; const el = document.querySelector(`[data-stop='${code}']`); if(!el) return;
  el.classList.remove('locked'); el.classList.add('unlocked');
  el.onclick = ()=> {
    if(code==='C'){ const rm=$('relocationModal'); if(rm){ rm.style.display='flex'; rm.setAttribute('aria-hidden','false'); const rc=$('relocClose'); if(rc) rc.onclick = ()=> { rm.style.display='none'; rm.setAttribute('aria-hidden','true'); } } }
    if(code==='A'){ showInfoModal("Udaipur","A gentle memory appears."); }
    unlockFutureStopsInOrder(idx+1);
  };
}

/* Gallery: messages only */
let slideshowTimer = null;
let currentSlide = 0;
let slidesMessages = [];

function openGalleryWithLoader(){
  const gm = $('galleryModal'); if(!gm) return;
  gm.style.display='flex'; gm.setAttribute('aria-hidden','false');
  const loader = $('galleryLoader'), body = $('galleryBody');
  if(loader) loader.style.display='block';
  if(body) body.style.display='none';

  const saved = localStorage.getItem('favMemory');
  slidesMessages = [];
  if(saved) slidesMessages.push("Your favourite memory: " + saved);
  slidesMessages = slidesMessages.concat([
    "I like the way you laugh when I‚Äôm being dramatic.",
    "You are my calm in the noisy world ‚Äî and my favourite chaos.",
    "Tiny promise: more hugs, more silly playlists, more us.",
    "No matter how many miles ‚Äî I pick you every time."
  ]);
  slidesMessages = slidesMessages.slice(0,6);

  setTimeout(()=> {
    const s1 = $('slideMsg1'), s2 = $('slideMsg2');
    if(s1) s1.textContent = slidesMessages[0] || "You are my favourite.";
    if(s2){
      if(slidesMessages.length>1){ s2.style.display='block'; s2.textContent = slidesMessages[1]; } else s2.style.display='none';
    }
    if(loader) loader.style.display='none';
    if(body) body.style.display='block';
    startSlideshow();
    spawnSparkles('sparkContainer'); spawnSparkles('sparkContainer2');
  }, 450);
}

function startSlideshow(){
  if(!slidesMessages.length) return;
  currentSlide = 0; updateSlide();
  if(slideshowTimer) clearInterval(slideshowTimer);
  slideshowTimer = setInterval(()=> { currentSlide = (currentSlide + 1) % slidesMessages.length; updateSlide(); }, 4200);
}
function stopSlideshow(){ if(slideshowTimer){ clearInterval(slideshowTimer); slideshowTimer=null; } }

function updateSlide(){
  const s1 = $('slideMsg1'), s2 = $('slideMsg2');
  if(!s1) return;
  if(slidesMessages.length===1){
    s1.textContent = slidesMessages[0];
    if(s2) s2.style.display='none';
  } else {
    const idx1 = currentSlide, idx2 = (currentSlide+1) % slidesMessages.length;
    s1.textContent = slidesMessages[idx1];
    if(s2){ s2.textContent = slidesMessages[idx2]; s2.style.display='block'; }
    if(s2){
      if(currentSlide % 2 === 0){ s1.style.opacity=1; s2.style.opacity=0.28; } else { s1.style.opacity=0.28; s2.style.opacity=1; }
    }
  }
}

/* Prev/Next manual controls */
if($('prevSlide')) $('prevSlide').addEventListener('click', ()=> { stopSlideshow(); if(!slidesMessages.length) return; currentSlide = (currentSlide - 1 + slidesMessages.length) % slidesMessages.length; updateSlide(); });
if($('nextSlide')) $('nextSlide').addEventListener('click', ()=> { stopSlideshow(); if(!slidesMessages.length) return; currentSlide = (currentSlide + 1) % slidesMessages.length; updateSlide(); });

function spawnSparkles(containerId){
  const container = $(containerId); if(!container) return;
  container.innerHTML='';
  for(let i=0;i<6;i++){ const d=document.createElement('div'); d.className='sparkle-dot'; d.style.left=(8+Math.random()*82)+'%'; d.style.top=(8+Math.random()*72)+'%'; d.style.animationDelay=(Math.random()*2)+'s'; container.appendChild(d); }
}

/* galleryClose: close + move to Stage 4 */
if($('galleryClose')){
  $('galleryClose').addEventListener('click', ()=> {
    const gm = $('galleryModal'); if(gm){ gm.style.display='none'; gm.setAttribute('aria-hidden','true'); }
    stopSlideshow();
    setTimeout(()=> { showPage('page4'); }, 220);
  });
}

/* defensive fallback: always let openGallery call loader */
if($('openGallery')){
  $('openGallery').addEventListener('click', (ev)=>{ ev && ev.preventDefault(); openGalleryWithLoader(); });
}

/* relocation close */
if($('relocClose')) $('relocClose').addEventListener('click', ()=> { const rm=$('relocationModal'); if(rm){ rm.style.display='none'; rm.setAttribute('aria-hidden','true'); } });

/* hug button (keeps the hug animation + optional action) */
if($('hugBtn')) $('hugBtn').addEventListener('click', ()=> {
  const b = $('bigHeart');
  if(b) { b.classList.add('expand'); setTimeout(()=> b.classList.remove('expand'),1600); }
});

/* See Future button -> moves to new page */
if($('seeFutureBtn')) $('seeFutureBtn').addEventListener('click', ()=> {
  showPage('pageFuture');
  revealFutureCards();
});

/* Back to start and finish future buttons */
if($('backToStart')) $('backToStart').addEventListener('click', ()=> { showPage('page1'); window.scrollTo({top:0,behavior:'smooth'}); resetAll(); });
if($('finishFuture')) $('finishFuture').addEventListener('click', ()=> { showInfoModal("Love you","That was our little future ‚Äî see you in all of it ‚ù§Ô∏è"); });

/* page switcher */
function showPage(id){
  document.querySelectorAll('.page').forEach(p=> p.classList.remove('active'));
  const node = $(id);
  if(node){ node.classList.add('active'); node.scrollIntoView({behavior:'smooth'}); }
  window.scrollTo({top:0,behavior:'smooth'});
}

/* Escape closes */
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape'){ ['infoModal','memoryModal','galleryModal','relocationModal','welcomeModal'].forEach(id=>{ const el=$(id); if(el){ el.style.display='none'; el.setAttribute('aria-hidden','true'); } }); stopSlideshow(); }});

/* initial sync */
window.addEventListener('load', ()=>{
  if($('meter1')) $('meter1').style.width = progress1 + '%';
  if($('meter2')) $('meter2').style.width = progress2 + '%';
  if($('meter4')) $('meter4').style.width = '75%';
});

/* ---------- Future cards logic ---------- */
const futureItems = [
  {icon:'‚úàÔ∏è', title:'Udaipur ‚Äî Our romantic trip', desc:'Sunset boat rides, lakes and chai.'},
  {icon:'üè°', title:'Our first home', desc:'A cosy corner full of plants and books.'},
  {icon:'üíê', title:'Wedding', desc:'Petals and a promise ‚Äî the loud happy day.'},
  {icon:'üë∂üêæ', title:'Babies & pets', desc:'Little footsteps and loud purring.'},
  {icon:'üöó', title:'Dream car', desc:'Roadtrips, silly playlists and snacks.'},
  {icon:'üåç', title:'Travel the world', desc:'Passport stamps and stolen camera moments.'},
  {icon:'üëµ‚ù§Ô∏èüë¥', title:'Growing old together', desc:'Lap naps, old jokes and backyard madness.'}
];

function revealFutureCards(){
  const grid = $('futureGrid'); if(!grid) return;
  grid.innerHTML = '';
  futureItems.forEach((it, idx) => {
    const card = document.createElement('div'); card.className='future-card';
    card.innerHTML = `<div class="future-icon">${it.icon}</div><div style="font-weight:700">${it.title}</div><div class="muted" style="font-size:14px">${it.desc}</div>`;
    grid.appendChild(card);
    // staggered reveal
    setTimeout(()=> card.classList.add('visible'), 120*idx);
  });
}

/* reset (optional) ‚Äî resets progress to re-test */
function resetAll(){
  // reset meters and state
  progress1 = 0; if($('meter1')) $('meter1').style.width = '0%';
  progress2 = 25; if($('meter2')) $('meter2').style.width = '25%';
  checkpointCount = 0; document.querySelectorAll('.checkpoint').forEach(el=>{ el.classList.remove('unlocked'); el.classList.add('locked'); });
  document.querySelectorAll('.flower').forEach(f=>{ f.classList.remove('collected'); f.style.pointerEvents='auto'; });
  // letter reset
  revealed = 0; if($('meter4')) $('meter4').style.width = '75%';
  const area = $('letterArea'); if(area){
    const preview = $('letterTextPreview'); area.innerHTML = ''; if(preview) area.appendChild(preview); area.appendChild($('letterHearts'));
  }
  // re-create hearts/flowers/letters
  createHearts(); createFlowers(); buildLetterHearts();
  // disable buttons
  if($('page1Skip')) $('page1Skip').disabled=true;
  if($('page2Letter')) $('page2Letter').disabled=true;
  if($('openGallery')) { $('openGallery').disabled=true; $('openGallery').setAttribute('aria-disabled','true'); }
  if($('page3Next')) $('page3Next').disabled=true;
  if($('finishLetter')) $('finishLetter').disabled=true;
  // go to top
  window.scrollTo({top:0,behavior:'smooth'});
}
</script>
</body>
</html>
