<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For Jay â€” From Shubhu â¤ï¸</title>
<meta name="description" content="A little interactive love site made by Shubhu for Jayu" />
<!-- ===========  CONFIG: change these filenames if you uploaded different images =========== -->
<script>
  // If you change filenames, update these three constants:
  const IMAGE_MEMORY = "memory1.jpg";   // memory gallery photo (Stage 3)
  const IMAGE_UDAIPUR = "udaipur.jpg";  // Udaipur photo (Journey Map)
  const NICK_SHUBHU = "Shubhu";
  const NICK_JAYU = "Jayu";
</script>
<style>
  /* ---------- Basics & palette ---------- */
  :root{
    --bg: #fff5f8;
    --panel: #fff;
    --accent: #ff6b9a;
    --accent-2: #ff9ac0;
    --muted: #6e6a73;
    --pink-soft: #ffeef6;
    --radius: 16px;
    --maxw: 980px;
    --shadow: 0 12px 36px rgba(181,99,136,0.12);
  }
  html,body{height:100%;margin:0;font-family: system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,#fff6fb 0%,#fffaf6 100%); color:#332a30}
  .wrap{max-width:var(--maxw);margin:26px auto;padding:20px;background:var(--panel);border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
  h1,h2{margin:0 0 10px}
  .center{display:flex;align-items:center;justify-content:center}
  .stage{min-height:60vh;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;padding:28px}
  button{cursor:pointer;border:0;border-radius:12px;padding:10px 16px;font-weight:600}
  .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;box-shadow:0 8px 24px rgba(255,107,154,0.15)}
  .btn-light{background:transparent;border:1px solid rgba(255,107,154,0.12);color:var(--accent)}
  p.small{color:var(--muted);font-size:14px;margin:0}

  /* ===== Page container (single-page app approach) ===== */
  .page{display:none}
  .page.active{display:block}
  .header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:8px 12px}
  .meter{width:100%;max-width:720px;background:linear-gradient(180deg,#fff 0%,#fffaf6 100%);border-radius:12px;padding:8px;border:1px solid rgba(0,0,0,0.04)}
  .meter-bar{height:16px;background:linear-gradient(90deg,var(--accent),var(--accent-2));border-radius:10px;width:0%;transition:width .3s ease}

  /* hearts grid */
  .hearts-area{width:320px;height:300px;border-radius:12px;background:linear-gradient(180deg,#fff0f6, #fff6fb);display:flex;flex-wrap:wrap;gap:8px;padding:10px;align-content:flex-start;overflow:hidden}
  .heart{width:56px;height:56px;border-radius:12px;background:linear-gradient(90deg,#ffd0e0,#ff9ac0);display:flex;align-items:center;justify-content:center;font-size:22px;color:white;user-select:none;box-shadow:0 8px 20px rgba(255,108,150,0.12)}
  .heart:active{transform:translateY(2px)}

  /* falling flowers */
  .flower-area{width:320px;height:360px;border-radius:12px;background:linear-gradient(180deg,#fffaf6,#fff5fb);overflow:hidden;padding:8px;display:flex;flex-wrap:wrap;align-content:flex-start}
  .flower{width:52px;height:52px;border-radius:10px;background:linear-gradient(90deg,#fff0f6,#ffdff0);display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 6px 18px rgba(255,107,154,0.06)}

  /* path map */
  .path-area{width:92%;max-width:760px;height:320px;border-radius:12px;background:linear-gradient(180deg,#fff,#fffaf6);display:flex;align-items:center;justify-content:center;padding:18px}
  .path-line{width:88%;height:6px;background:repeating-linear-gradient(90deg,var(--accent) 0 10px, transparent 10px 20px);border-radius:12px;position:relative}
  .checkpoint{position:absolute;top:-20px;transform:translateX(-50%);background:linear-gradient(180deg,#fff,#ffeef6);padding:6px 10px;border-radius:10px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 12px 30px rgba(170,90,130,0.06)}

  /* letter reveal */
  .letter-area{width:100%;max-width:720px;border-radius:12px;padding:18px;background:linear-gradient(180deg,#fff,#fff9fb);border:1px dashed rgba(255,107,154,0.12)}

  /* journey map */
  .map-area{width:100%;max-width:900px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#fff,#fff6fb);display:flex;flex-direction:column;gap:12px}
  .map-row{display:flex;gap:12px;align-items:center;padding:10px;border-radius:12px;background:linear-gradient(90deg,#fff,#fff6fb);border:1px solid rgba(0,0,0,0.03)}
  .map-icon{width:64px;height:64px;border-radius:12px;background:linear-gradient(90deg,#ffdff0,#fff0f6);display:flex;align-items:center;justify-content:center;font-size:26px;color:#c03a6d}
  .locked{opacity:.45;filter:grayscale(.08)}
  .unlocked{animation:pop .4s ease}
  @keyframes pop{0%{transform:scale(.92)}50%{transform:scale(1.05)}100%{transform:scale(1)}}

  /* final hug */
  .final{padding:36px;text-align:center}
  .big-heart{width:180px;height:180px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #ff90b0, #ff4f82);margin:18px auto;box-shadow:0 20px 60px rgba(255,80,130,0.14);transform:scale(.9);transition:transform .4s ease}
  .big-heart.expand{transform:scale(1.08)}

  /* responsive */
  @media (max-width:720px){
    .hearts-area,.flower-area{width:90%}
    .map-row{flex-direction:row;flex-wrap:wrap}
  }
  /* small helper */
  .muted{color:var(--muted)}
  input[type="text"],textarea{padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);width:100%;max-width:420px}
  .tiny{font-size:13px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap" role="main" aria-label="For Jay site">
    <div class="header">
      <div style="display:flex;gap:12px;align-items:center">
        <div style="width:48px;height:48px;border-radius:12px;background:linear-gradient(90deg,#ffafc9,#ff7aa5);display:flex;align-items:center;justify-content:center;color:white;font-weight:700">ğŸ’—</div>
        <div>
          <div style="font-weight:700">A little corner for <span id="nick-jayu">Jayu</span></div>
          <div class="tiny">Made with love by <strong id="nick-shubhu">Shubhu</strong></div>
        </div>
      </div>
      <div class="tiny muted">Tip: progress is saved locally in your browser</div>
    </div>

    <!-- ---------- Welcome pop-up (modal-style, first thing) ---------- -->
    <div id="welcomeModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.18);display:flex;align-items:center;justify-content:center;z-index:60">
      <div style="width:92%;max-width:680px;background:var(--panel);padding:22px;border-radius:18px;text-align:center;box-shadow:0 18px 46px rgba(150,70,120,0.12)">
        <h2>Hey Jayu â€” a tiny rule from your baby</h2>
        <p class="muted">Close your eyes for a beat and imagine <strong id="nick-shubhu-inline">Shubhu</strong> pulling your face and saying:</p>
        <p style="font-weight:700;font-size:18px;margin:10px 0">â€œI always win because Iâ€™m the baby ğŸ˜¤ğŸ’— â€” and youâ€™ll pamper me.â€</p>
        <p class="muted">Tap to accept your job as the official pamperer.</p>
        <div style="display:flex;gap:12px;justify-content:center;margin-top:12px">
          <button class="btn-primary" id="welcomeAccept">Okay boss-baby ğŸ’—</button>
        </div>
      </div>
    </div>

    <!-- PAGES -->
    <!-- Stage 1 -->
    <section id="page1" class="page active">
      <div class="stage">
        <h1>Stage 1 â€” Tap hearts (0 â†’ 25%)</h1>
        <div class="meter" aria-hidden>
          <div class="meter-bar" id="meter1" style="width:0%"></div>
        </div>
        <div class="hearts-area" id="heartsArea" aria-label="tap hearts">
          <!-- hearts will be injected -->
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <button class="btn-light" id="page1Skip" disabled>Next (locked)</button>
          <div class="tiny muted">Tap hearts to fill the meter â€” no skipping!</div>
        </div>
      </div>
    </section>

    <!-- Stage 2 -->
    <section id="page2" class="page">
      <div class="stage">
        <h1>Stage 2 â€” Catch flowers (25 â†’ 50%)</h1>
        <div class="meter" aria-hidden>
          <div class="meter-bar" id="meter2" style="width:0%"></div>
        </div>
        <div class="flower-area" id="flowerArea" aria-label="catch flowers">
          <!-- flowers will be injected -->
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <button class="btn-light" id="page2Letter" disabled>Open Mini Letter</button>
          <div class="tiny muted">Collect flowers to unlock the letter</div>
        </div>
      </div>
    </section>

    <!-- Stage 3 -->
    <section id="page3" class="page">
      <div class="stage">
        <h1>Stage 3 â€” Follow our tiny path (50 â†’ 75%)</h1>
        <div class="path-area">
          <div class="path-line" id="pathLine">
            <!-- checkpoints positioned via JS -->
          </div>
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <button class="btn-light" id="openGallery" disabled>View Memory Snaps</button>
          <div class="tiny muted">Tap each checkpoint â€” donâ€™t skip steps, Jayu!</div>
        </div>
      </div>
    </section>

    <!-- Stage 4 -->
    <section id="page4" class="page">
      <div class="stage">
        <h1>Stage 4 â€” A line-by-line letter (75 â†’ 100%)</h1>
        <div class="meter" aria-hidden>
          <div class="meter-bar" id="meter4" style="width:0%"></div>
        </div>
        <div class="letter-area" id="letterArea">
          <p id="letterTextPreview" class="muted">Tap each tiny heart to reveal the next line of my letter.</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px" id="letterHearts"></div>
        </div>
        <div style="display:flex;gap:10px;align-items:center;margin-top:10px">
          <button class="btn-primary" id="finishLetter" disabled>Open Final Surprise</button>
          <div class="tiny muted">Reveal the full letter to continue</div>
        </div>
      </div>
    </section>

    <!-- Journey Map -->
    <section id="pageMap" class="page">
      <div style="padding:18px" class="stage">
        <h1>Journey Map â€” Tap each stop</h1>
        <p class="muted">Tap each stop in order. After you answer Stop 5, the future stops will unlock.</p>
        <div class="map-area" id="mapArea" aria-live="polite">
          <!-- Past (1-5) -->
          <div class="map-row locked" data-stop="1" id="stop-1">
            <div class="map-icon">ğŸ«</div>
            <div>
              <div style="font-weight:700">2005â€“06 â€” GIPCL School, Gujarat</div>
              <div class="muted">Where our story starts</div>
            </div>
          </div>

          <div class="map-row locked" data-stop="2" id="stop-2">
            <div class="map-icon">ğŸ’¬</div>
            <div>
              <div style="font-weight:700">Bench partners â†’ IG reunion (2017)</div>
              <div class="muted">We reconnected years later</div>
            </div>
          </div>

          <div class="map-row locked" data-stop="3" id="stop-3">
            <div class="map-icon">ğŸ’—</div>
            <div>
              <div style="font-weight:700">2019 â€” <span id="proposeText">Shubhu proposed first</span></div>
              <div class="muted">My bold baby move</div>
            </div>
          </div>

          <div class="map-row locked" data-stop="4" id="stop-4">
            <div class="map-icon">ğŸŒ™</div>
            <div>
              <div style="font-weight:700">2019â€“2025 â€” Long distance</div>
              <div class="muted">We waited, we talked, we met in 2025</div>
            </div>
          </div>

          <div class="map-row locked" data-stop="5" id="stop-5">
            <div class="map-icon">ğŸ“¸</div>
            <div>
              <div style="font-weight:700">Your favourite memory</div>
              <div class="muted">Jayu â€” tell your Shubhu one memory (required)</div>
            </div>
            <div style="margin-left:auto">
              <button class="btn-light" id="openMemoryBox">Tell memory</button>
            </div>
          </div>

          <!-- Future stops (locked until past done) -->
          <div id="futureStops" style="display:none;flex-direction:column;gap:10px;margin-top:8px">
            <div class="map-row locked" data-stop="A" id="stop-A">
              <div class="map-icon">âœˆï¸</div>
              <div>
                <div style="font-weight:700">Udaipur â€” Our romantic trip</div>
                <div class="muted">A memory in the city of lakes</div>
              </div>
            </div>

            <div class="map-row locked" data-stop="B" id="stop-B">
              <div class="map-icon">ğŸ¡</div>
              <div>
                <div style="font-weight:700">Our first home</div>
                <div class="muted">A cosy corner full of flowers</div>
              </div>
            </div>

            <div class="map-row locked" data-stop="C" id="stop-C">
              <div class="map-icon">ğŸ’</div>
              <div>
                <div style="font-weight:700">Wedding</div>
                <div class="muted">Petals and a promise</div>
              </div>
            </div>

            <div class="map-row locked" data-stop="D" id="stop-D">
              <div class="map-icon">ğŸ‘¶ğŸ¾</div>
              <div>
                <div style="font-weight:700">Babies & pets</div>
                <div class="muted">A warm noisy home (but the quiet parts are cute)</div>
              </div>
            </div>

            <div class="map-row locked" data-stop="E" id="stop-E">
              <div class="map-icon">ğŸš—</div>
              <div>
                <div style="font-weight:700">Dream car</div>
                <div class="muted">Roadtrips & silly playlists</div>
              </div>
            </div>

            <div class="map-row locked" data-stop="F" id="stop-F">
              <div class="map-icon">ğŸ®</div>
              <div>
                <div style="font-weight:700">Game room (PS5)</div>
                <div class="muted">Late-night co-op & snacks</div>
              </div>
            </div>

            <div class="map-row locked" data-stop="G" id="stop-G">
              <div class="map-icon">ğŸ’¼</div>
              <div>
                <div style="font-weight:700">Business together</div>
                <div class="muted">Our little empire</div>
              </div>
            </div>

            <div class="map-row locked" data-stop="H" id="stop-H">
              <div class="map-icon">ğŸŒ</div>
              <div>
                <div style="font-weight:700">Travel the world</div>
                <div class="muted">Stamp collection, and you stealing my camera</div>
              </div>
            </div>

            <div class="map-row locked" data-stop="K" id="stop-K">
              <div class="map-icon">ğŸ‘µâ¤ï¸ğŸ‘´</div>
              <div>
                <div style="font-weight:700">Growing old in a big fat family home</div>
                <div class="muted">Lap naps, old jokes, and backyard madness</div>
              </div>
            </div>
          </div>

        </div>

        <div style="margin-top:12px;display:flex;gap:10px;align-items:center">
          <button class="btn-primary" id="mapFinish" disabled>Finish Journey â†’</button>
          <div class="tiny muted">Complete all stops to finish</div>
        </div>
      </div>
    </section>

    <!-- Memory modal -->
    <div id="memoryModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.2);align-items:center;justify-content:center;z-index:80">
      <div style="background:var(--panel);padding:18px;border-radius:12px;max-width:520px">
        <h3>Jayu â€” your favourite memory</h3>
        <p class="muted tiny">Type one memory you love most. This saves locally on your device.</p>
        <textarea id="memoryInput" rows="4" placeholder="Type your memory..."></textarea>
        <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:8px">
          <button class="btn-light" id="memoryCancel">Cancel</button>
          <button class="btn-primary" id="memorySave">Save memory</button>
        </div>
      </div>
    </div>

    <!-- Relocation & travel map inside wedding stop (simple arc animation) -->
    <div id="relocationModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.18);align-items:center;justify-content:center;z-index:70">
      <div style="background:var(--panel);padding:18px;border-radius:12px;max-width:720px;">
        <h3>Relocation â€” a tiny journey animation</h3>
        <p class="muted tiny">A visual map from Jharkhand â†’ Washington DC (no text, visual only)</p>
        <div style="width:100%;height:320px;border-radius:12px;background:linear-gradient(180deg,#fff,#fff6fb);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden">
          <!-- stylized world box with arc -->
          <svg viewBox="0 0 100 50" preserveAspectRatio="none" style="width:90%;height:80%">
            <!-- subtle world background (very simplified rectangles) -->
            <rect x="0" y="0" width="100" height="50" fill="#fffdfd"/>
            <!-- arc path -->
            <path id="arcPath" d="M10 38 C 35 5, 65 5, 90 38" stroke="rgba(255,107,154,0.22)" stroke-width="1.6" fill="none" stroke-dasharray="2 2"/>
            <!-- plane marker (animated along the path) -->
            <circle r="1.2" fill="#ff4f82">
              <animateMotion begin="0s" dur="3.8s" repeatCount="1" fill="freeze">
                <mpath xlink:href="#arcPath" />
              </animateMotion>
            </circle>
            <!-- start & end markers -->
            <circle cx="10" cy="38" r="1.8" fill="#ff7aa5"/>
            <circle cx="90" cy="38" r="1.8" fill="#ff7aa5"/>
          </svg>
        </div>
        <div style="display:flex;justify-content:flex-end;margin-top:8px;gap:8px">
          <button class="btn-light" id="relocClose">Close</button>
        </div>
      </div>
    </div>

    <!-- Memory gallery modal -->
    <div id="galleryModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.18);align-items:center;justify-content:center;z-index:70">
      <div style="background:var(--panel);padding:18px;border-radius:12px;max-width:900px;">
        <h3>Memory Snaps</h3>
        <div style="display:flex;gap:12px;flex-wrap:wrap;padding:8px">
          <div style="width:280px;border-radius:12px;overflow:hidden">
            <img id="memImg1" src="" alt="memory 1" style="width:100%;height:220px;object-fit:cover;display:block"/>
          </div>
          <div style="width:280px;border-radius:12px;overflow:hidden">
            <img id="memImg2" src="" alt="memory 2" style="width:100%;height:220px;object-fit:cover;display:block"/>
          </div>
        </div>
        <div style="display:flex;justify-content:flex-end;margin-top:8px">
          <button class="btn-light" id="galleryClose">Close</button>
        </div>
      </div>
    </div>

    <!-- final page -->
    <section id="pageFinal" class="page">
      <div class="stage final">
        <h1>Close your eyes and smile, Jayuâ€¦</h1>
        <p class="muted">Imagine every version of us â€” school kids, long-distance fools, and old home-makers â€” and smile. In every timeline, I choose you.</p>
        <div class="big-heart" id="bigHeart"></div>
        <div><button class="btn-primary" id="hugBtn">Hug Shubhu ğŸ¤</button></div>
      </div>
    </section>

  </div>

<script>
/* ---------- small helpers ---------- */
const $ = (id)=>document.getElementById(id);

/* insert nicknames */
document.getElementById('nick-jayu').textContent = (typeof NICK_JAYU !== 'undefined') ? NICK_JAYU : "Jayu";
document.getElementById('nick-shubhu').textContent = (typeof NICK_SHUBHU !== 'undefined') ? NICK_SHUBHU : "Shubhu";
document.getElementById('nick-shubhu-inline').textContent = (typeof NICK_SHUBHU !== 'undefined') ? NICK_SHUBHU : "Shubhu";

/* Welcome modal flow */
$('welcomeAccept').addEventListener('click', ()=>{
  $('welcomeModal').style.display = 'none';
});

/* ---------- Stage 1: hearts ---------- */
const meter1 = $('meter1');
let progress1 = 0;
const target1 = 25;
const heartsArea = $('heartsArea');

function createHearts(){
  heartsArea.innerHTML = '';
  for(let i=0;i<12;i++){
    const d = document.createElement('div');
    d.className = 'heart';
    d.textContent = 'ğŸ’•';
    d.style.cursor = 'pointer';
    d.addEventListener('click', ()=> {
      if(progress1 >= target1) return;
      progress1 += Math.floor(Math.random()*3)+1;
      if(progress1>target1) progress1 = target1;
      meter1.style.width = progress1 + '%';
      d.style.transform = 'scale(.96) translateY(2px)';
      setTimeout(()=> d.style.transform = '', 120);
      checkStage1();
    });
    heartsArea.appendChild(d);
  }
}
function checkStage1(){
  if(progress1 >= target1){
    $('page1').classList.remove('active');
    // enable next button but ensure they click it to continue
    $('page1Skip').disabled = false;
    $('page1Skip').addEventListener('click', ()=> {
      showPage('page2');
    }, {once:true});
  }
}
createHearts();

/* ---------- Stage 2: flower catch ---------- */
const flowerArea = $('flowerArea');
let progress2 = 25;
const target2 = 50;
function createFlowers(){
  flowerArea.innerHTML = '';
  for(let i=0;i<20;i++){
    const f = document.createElement('div');
    f.className = 'flower';
    // sprinkle icons (flowers, football, ps5, car)
    const icons = ['ğŸŒ¸','âš½','ğŸ®','ğŸš—'];
    f.textContent = icons[Math.floor(Math.random()*icons.length)];
    f.addEventListener('click', ()=> {
      if(progress2 >= target2) return;
      progress2 += 2;
      if(progress2>target2) progress2 = target2;
      $('meter2').style.width = (progress2) + '%';
      f.style.opacity = '0.25';
      f.style.transform = 'scale(.88)';
      checkStage2();
    });
    flowerArea.appendChild(f);
  }
}
function checkStage2(){
  if(progress2 >= target2){
    $('page2Letter').disabled = false;
    $('page2Letter').addEventListener('click', ()=> {
      // show a short letter modal (quick inline)
      alert("Mini letter from " + (typeof NICK_SHUBHU!=='undefined'?NICK_SHUBHU:'Shubhu') + ": \"Halfway, and I kept choosing you.\"");
      showPage('page3');
    }, {once:true});
  }
}
createFlowers();

/* ---------- Stage 3: path checkpoints ---------- */
const pathLine = $('pathLine');
let checkpointCount = 0;
const checkpoints = [
  {x:8, label:"We learned to trust."},
  {x:28, label:"We learned to stay."},
  {x:52, label:"We learned to love deeper."},
  {x:76, label:"We chose each other."}
];
function buildPath(){
  pathLine.innerHTML = '';
  checkpoints.forEach((cp,i)=>{
    const el = document.createElement('div');
    el.className = 'checkpoint locked';
    el.style.left = cp.x + '%';
    el.id = 'cp-'+i;
    el.innerHTML = `<div style="font-weight:700">â€¢</div><div class="muted tiny">${cp.label}</div>`;
    el.addEventListener('click', ()=> {
      if(i>checkpointCount) {
        // blocked - cannot skip ahead
        alert("Follow the path in order, Jayu â€” one step at a time ğŸ˜Š");
        return;
      }
      // unlock this checkpoint
      el.classList.remove('locked');
      el.classList.add('unlocked');
      // reveal small message
      const pop = document.createElement('div');
      pop.style.position='absolute';
      pop.style.left = (cp.x-6)+'%';
      pop.style.top = '-48px';
      pop.style.background = 'var(--panel)';
      pop.style.padding='8px 10px';
      pop.style.borderRadius='10px';
      pop.style.boxShadow='0 8px 24px rgba(0,0,0,0.06)';
      pop.innerHTML = `<strong>${cp.label}</strong>`;
      pathLine.appendChild(pop);
      checkpointCount++;
      const percent = 50 + Math.floor((checkpointCount/checkpoints.length)*25);
      $('meter2').style.width = percent + '%';
      if(checkpointCount === checkpoints.length){
        $('openGallery').disabled = false;
        $('openGallery').addEventListener('click', ()=> {
          // show gallery modal
          $('memImg1').src = (typeof IMAGE_MEMORY !== 'undefined') ? IMAGE_MEMORY : '';
          $('memImg2').src = (typeof IMAGE_UDAIPUR !== 'undefined') ? IMAGE_UDAIPUR : '';
          $('galleryModal').style.display = 'flex';
        }, {once:true});
      }
    });
    pathLine.appendChild(el);
  });
  // attach close for gallery
  $('galleryClose').addEventListener('click', ()=> $('galleryModal').style.display = 'none');
}
buildPath();

/* ---------- Stage 4: letter reveal ---------- */
const letterLines = [
  "Even when the world was loud,",
  "I kept hearing your quiet laugh.",
  "Even when miles stretched long,",
  "You were the place I came home to.",
  "You are my calm and my chaos.",
  "I choose you â€” again and again."
];
let revealed = 0;
const letterHearts = $('letterHearts');
function buildLetterHearts(){
  letterHearts.innerHTML = '';
  for(let i=0;i<letterLines.length;i++){
    const h = document.createElement('div');
    h.className = 'heart';
    h.style.cursor='pointer';
    h.textContent = 'ğŸ’—';
    h.addEventListener('click', ()=>{
      if(h.dataset.revealed === 'true') return;
      const p = document.createElement('div');
      p.style.marginTop='8px';
      p.style.fontWeight='600';
      p.textContent = letterLines[i];
      $('letterArea').insertBefore(p, letterHearts);
      h.dataset.revealed = 'true';
      revealed++;
      const percent = 75 + Math.floor((revealed/letterLines.length)*25);
      $('meter4').style.width = percent + '%';
      if(revealed === letterLines.length){
        $('finishLetter').disabled = false;
        $('finishLetter').addEventListener('click', ()=> {
          showPage('pageMap');
          // unlock first map stop after finishing
          unlockMapStop(1);
        }, {once:true});
      }
    });
    letterHearts.appendChild(h);
  }
}
buildLetterHearts();

/* ---------- Journey Map logic ---------- */
function unlockMapStop(n){
  // find element by data-stop (numeric or letters)
  const id = (typeof n === 'number') ? 'stop-'+n : 'stop-'+n;
  const el = (n>0 && n<=5) ? $('stop-'+n) : document.querySelector(`[data-stop='${n}']`);
  if(!el) return;
  el.classList.remove('locked');
  el.classList.add('unlocked');
}

/* click handlers for the initial past stops */
['stop-1','stop-2','stop-3','stop-4'].forEach(id=>{
  const el = $(id);
  el.addEventListener('click', ()=> {
    if(el.classList.contains('locked')) { alert("Complete previous steps to unlock this stop, Jayu."); return; }
    // simple popup with story
    alert(el.querySelector('.muted').textContent + " â€” " + el.querySelector('div[style*=\"font-weight:700\"]').textContent);
    // unlock next numeric stop if exists
    const nextNum = parseInt(id.split('-')[1]) + 1;
    if($('stop-'+nextNum)) unlockMapStop(nextNum);
  });
});

/* Stop 5 - favourite memory (mandatory) */
$('openMemoryBox').addEventListener('click', ()=>{
  $('memoryModal').style.display = 'flex';
  const saved = localStorage.getItem('favMemory');
  if(saved) $('memoryInput').value = saved;
});
$('memoryCancel').addEventListener('click', ()=> $('memoryModal').style.display = 'none');
$('memorySave').addEventListener('click', ()=>{
  const val = $('memoryInput').value.trim();
  if(!val){ alert("Please share one memory, Jayu â€” your Shubhu is waiting!"); return; }
  localStorage.setItem('favMemory', val);
  $('memoryModal').style.display = 'none';
  // show small toast-like alert and unlock future stops container
  alert("Memory saved. Thank you, Jayu ğŸ’—");
  // reveal future stops block
  $('futureStops').style.display = 'flex';
  // unlock first future stop
  unlockFutureStopsInOrder(0);
});

/* helper to unlock future stops strictly in order */
const futureList = ['A','B','C','D','E','F','G','H','K'];
function unlockFutureStopsInOrder(idx){
  if(idx >= futureList.length) {
    $('mapFinish').disabled = false;
    return;
  }
  const code = futureList[idx];
  const el = document.querySelector(`[data-stop='${code}']`);
  // unlock the element for interaction
  el.classList.remove('locked');
  el.classList.add('unlocked');
  // attach click behaviour that then unlocks next
  el.addEventListener('click', ()=> {
    // if this is wedding (C) show relocation modal
    if(code === 'C') {
      $('relocationModal').style.display = 'flex';
      // ensure close button hides it
      $('relocClose').onclick = ()=> $('relocationModal').style.display = 'none';
    }
    // For Udaipur, show the uploaded photo inside:
    if(code === 'A'){
      // show the udaipur image inside gallery area or as an alert (lightweight)
      alert("Udaipur stop â€” a gentle memory appears.");
    }
    // After click, mark unlocked and proceed to next
    el.classList.add('unlocked');
    // unlock next one
    unlockFutureStopsInOrder(idx+1);
  }, {once:true});
}

/* map finish */
$('mapFinish').addEventListener('click', ()=> {
  // ensure all future stops done (we guard by enabling this button at end)
  alert("You completed the journey, Jayu. One last surprise awaits.");
  showPage('pageFinal');
});

/* gallery modal close handled earlier */

/* big hug animation */
$('hugBtn').addEventListener('click', ()=>{
  const b = $('bigHeart');
  b.classList.add('expand');
  setTimeout(()=> b.classList.remove('expand'), 1600);
});

/* small function to switch pages (simple single-page app) */
function showPage(id){
  document.querySelectorAll('.page').forEach(p=> p.classList.remove('active'));
  // hide modals if any
  $('welcomeModal').style.display = 'none';
  if($(id)) $(id).classList.add('active');
  // small scroller
  window.scrollTo({top:0,behavior:'smooth'});
}

/* unlocking initial map progression once on map page */
document.addEventListener('click', function(e){
  // when we first land on map, ensure stop-1 is unlocked (we set earlier)
  // nothing here for now
});

/* attach gallery open/close */
$('galleryClose').addEventListener('click', ()=> $('galleryModal').style.display = 'none');

/* initial state: page1 is visible; page1Skip locked until complete */
/* slight safety: if localStorage had progress markers (optional) you could read them here */
/* show memory image placeholders (they will be set when gallery opens) */

/* Extra: if user refreshes, we try to keep them on the same page via a simple pointer */
(function restorePointer(){
  // no persistent pointer needed for now
})();

</script>
</body>
</html>
