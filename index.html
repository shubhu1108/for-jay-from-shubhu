<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>For Jay â€” From Shubhu â¤ï¸</title>
<meta name="description" content="A little interactive love site made by Shubhu for Jayu" />
<script>
  const IMAGE_MEMORY = "memory1.jpg";
  const IMAGE_UDAIPUR = "udaipur.jpg";
  const NICK_SHUBHU = "Shubhu";
  const NICK_JAYU = "Jayu";
</script>

<style>
:root{
  --bg1: #fff6f9; --panel: #ffffff; --accent1: #ff7aa5; --accent2: #ffc2d9;
  --muted: #6b656b; --soft-shadow: 0 18px 48px rgba(160,80,120,0.08);
  --glass: rgba(255,255,255,0.85); --radius: 18px; --maxw: 1000px;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#fff7f9 0%,#fff2f7 100%);font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Helvetica Neue",Arial;color:#2f2329; -webkit-font-smoothing:antialiased}
.wrap{max-width:var(--maxw);margin:28px auto;padding:18px;background:var(--panel);border-radius:26px;box-shadow:var(--soft-shadow);overflow:hidden}
.header{display:flex;align-items:center;justify-content:space-between;padding:14px;border-radius:14px}
.brand{display:flex;gap:12px;align-items:center}
.logo{width:60px;height:60px;border-radius:14px;background:linear-gradient(180deg,var(--accent2),var(--accent1));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:26px;box-shadow:0 10px 30px rgba(255,110,150,0.08)}
.title{font-weight:800;font-size:18px}
.subtitle{font-size:13px;color:var(--muted);margin-top:2px}
.tip{color:var(--muted);font-size:14px}

/* Page layout */
.page{display:none;opacity:0;transform:translateY(14px);transition:opacity .7s cubic-bezier(.2,.9,.2,1), transform .7s cubic-bezier(.2,.9,.2,1)}
.page.active{display:block;opacity:1;transform:none}
.stage{min-height:66vh;display:flex;flex-direction:column;gap:18px;align-items:center;justify-content:flex-start;padding:28px}

/* meters & blocks */
.meter{width:100%;max-width:760px;background:linear-gradient(180deg,#fff,#fffaf6);border-radius:12px;padding:8px;border:1px solid rgba(0,0,0,0.04)}
.meter-bar{height:16px;background:linear-gradient(90deg,var(--accent1),var(--accent2));border-radius:10px;width:0%;transition:width .6s ease}

/* hearts grid & flowers */
.hearts-area{width:360px;height:300px;border-radius:14px;background:linear-gradient(180deg,#fff4f8,#fff9fb);display:flex;flex-wrap:wrap;gap:10px;padding:12px;align-content:flex-start;box-shadow:0 12px 36px rgba(200,130,160,0.04)}
.heart{width:66px;height:66px;border-radius:14px;background:linear-gradient(90deg,#ffdfea,#ffb7d6);display:flex;align-items:center;justify-content:center;font-size:26px;color:white;user-select:none;box-shadow:0 14px 36px rgba(240,120,160,0.08);transition:transform .18s ease}
.heart:active{transform:translateY(2px) scale(.98)}
.flower-area{width:360px;height:360px;border-radius:14px;background:linear-gradient(180deg,#fffaf6,#fff6fb);overflow:hidden;padding:12px;display:flex;flex-wrap:wrap;align-content:flex-start;box-shadow:0 12px 36px rgba(180,120,150,0.04)}
.flower{width:56px;height:56px;border-radius:12px;background:linear-gradient(90deg,#fff0f6,#ffdff0);display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 8px 22px rgba(255,107,154,0.06);cursor:pointer;transition:transform .18s ease, opacity .3s ease}
.flower.collected{opacity:.28;transform:scale(.88);pointer-events:none}

/* path checkpoints */
.path-area{width:92%;max-width:820px;height:320px;border-radius:16px;background:linear-gradient(180deg,#fff,#fffaf6);display:flex;align-items:center;justify-content:center;padding:20px}
.path-line{width:88%;height:8px;background:repeating-linear-gradient(90deg,#ffd7e5 0 12px, transparent 12px 24px);border-radius:12px;position:relative}
.checkpoint{position:absolute;top:-30px;transform:translateX(-50%);background:var(--glass);padding:8px 12px;border-radius:12px;border:1px solid rgba(0,0,0,0.04);box-shadow:0 12px 36px rgba(170,90,130,0.05);cursor:pointer;transition:transform .22s ease, box-shadow .22s ease}
.checkpoint.unlocked{transform:translateX(-50%) scale(1.03);box-shadow:0 18px 48px rgba(200,100,140,0.08)}

/* letter reveal */
.letter-area{width:100%;max-width:760px;border-radius:12px;padding:20px;background:linear-gradient(180deg,#fff,#fff9fb);border:1px dashed rgba(255,107,154,0.06);box-shadow:0 10px 30px rgba(200,120,150,0.03)}

/* journey map */
.map-area{width:100%;max-width:900px;padding:18px;border-radius:12px;background:linear-gradient(180deg,#fff,#fff6fb);display:flex;flex-direction:column;gap:12px}
.map-row{display:flex;gap:14px;align-items:center;padding:12px;border-radius:12px;background:linear-gradient(90deg,#fff,#fff6fb);border:1px solid rgba(0,0,0,0.03);transition:transform .22s ease, box-shadow .22s ease}
.map-row.locked{opacity:.46;filter:grayscale(.02);pointer-events:none}
.map-row.unlocked{transform:translateY(-2px);box-shadow:0 12px 36px rgba(200,110,140,0.04);pointer-events:auto}
.map-icon{width:64px;height:64px;border-radius:12px;background:linear-gradient(90deg,#ffdff0,#fff0f6);display:flex;align-items:center;justify-content:center;font-size:28px;color:#c03a6d}

/* modal (soft) */
.modal-backdrop{position:fixed;inset:0;background:rgba(20,15,20,0.06);display:flex;align-items:center;justify-content:center;z-index:9999}
.modal{width:92%;max-width:780px;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.96));padding:20px;border-radius:16px;box-shadow:0 40px 80px rgba(240,120,160,0.08)}
.modal h3{margin:0 0 8px;font-weight:800}
.modal .muted{color:var(--muted)}

/* gallery messages (replaces photos) */
.gallery-message{width:360px;height:260px;border-radius:14px;overflow:hidden;position:relative;background:linear-gradient(180deg,#fff,#fff6fb);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;padding:18px;text-align:center;box-shadow:0 14px 36px rgba(200,120,160,0.04)}
.gallery-message.small{font-size:16px}

/* sparkle */
.sparkle-dot{position:absolute;width:8px;height:8px;background:rgba(255,255,255,0.9);border-radius:50%;box-shadow:0 0 8px rgba(255,200,230,0.8);opacity:0;animation:popSpark 3.8s infinite}
@keyframes popSpark{0%{transform:scale(.7) translateY(10px);opacity:0}12%{opacity:1}45%{transform:scale(1.6) translateY(-20px);opacity:.95}100%{opacity:0}}

/* spinner */
.spinner{width:56px;height:56px;border-radius:50%;border:5px solid rgba(255,107,154,0.12);border-top-color:var(--accent1);animation:spin 1.2s linear infinite;margin:18px auto}
@keyframes spin{to{transform:rotate(360deg)}}

/* final heart */
.big-heart{width:220px;height:220px;border-radius:50%;background:radial-gradient(circle at 30% 30%, #ffb0c9, #ff5a8a);margin:20px auto;box-shadow:0 30px 80px rgba(255,90,140,0.12);transform:scale(.96);transition:transform .6s cubic-bezier(.2,.9,.2,1)}
.big-heart.expand{transform:scale(1.06)}

/* footer */
footer{margin-top:18px;padding:14px;text-align:center;font-size:13px;color:var(--muted)}

/* floating hearts background (ALL pages) */
#floatingHeartBg{position:fixed;inset:0;pointer-events:none;z-index:2;overflow:hidden}
.fh{position:absolute;opacity:.12;transform:translateY(0);animation:fhFloat linear infinite}
@keyframes fhFloat{0%{transform:translateY(60vh) scale(.6);opacity:.04}50%{transform:translateY(20vh) scale(1);opacity:.12}100%{transform:translateY(-40vh) scale(.95);opacity:0}}

.btn-primary{cursor:pointer;border:0;border-radius:12px;padding:10px 16px;font-weight:700;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;box-shadow:0 12px 36px rgba(255,90,140,0.08)}
.btn-light{cursor:pointer;border-radius:12px;padding:8px 12px;background:transparent;border:1px solid rgba(255,107,154,0.12);color:var(--accent1);font-weight:700}
.muted{color:var(--muted)}
.tiny{font-size:13px;color:var(--muted)}
@media (max-width:820px){
  .hearts-area,.flower-area{width:92%}
  .gallery-message{width:260px;height:180px}
  .wrap{margin:12px;padding:12px}
}
</style>
</head>
<body>
  <div id="floatingHeartBg" aria-hidden="true"></div>

  <div class="wrap" role="main" aria-label="For Jay site">
    <div class="header">
      <div class="brand">
        <div class="logo">ğŸ’—</div>
        <div>
          <div class="title">A little corner for <strong id="nick-jayu">Jayu</strong></div>
          <div class="subtitle">Made with love by <strong id="nick-shubhu">Shubhu</strong></div>
        </div>
      </div>
      <div class="tip">Shubhu ka attitude, Jayu ke liye mute.</div>
    </div>

    <div id="welcomeModal" class="modal-backdrop" role="dialog" aria-modal="true" style="display:flex">
      <div class="modal" style="text-align:center">
        <h3 id="welcomeTitle">Hey Jayu â€” a tiny rule from your baby</h3>
        <p class="muted">Close your eyes for a beat and imagine <strong id="nick-shubhu-inline">Shubhu</strong> pulling your face and saying:</p>
        <p style="font-weight:800;font-size:18px;margin:10px 0">â€œI always win because Iâ€™m the baby ğŸ˜¤ğŸ’— â€” and youâ€™ll pamper me.â€</p>
        <p class="muted">Tap to accept your job as the official pamperer.</p>
        <div style="display:flex;justify-content:center;margin-top:12px">
          <button class="btn-primary" id="welcomeAccept">Okay boss-baby ğŸ’—</button>
        </div>
      </div>
    </div>

    <!-- Stage 1 -->
    <section id="page1" class="page active">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Stage 1 â€” Tap hearts (0 â†’ 25%)</h1>
        <div class="meter" aria-hidden>
          <div class="meter-bar" id="meter1" style="width:0%"></div>
        </div>
        <div class="hearts-area" id="heartsArea" aria-label="tap hearts" role="region" aria-live="polite"></div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center">
          <button class="btn-light" id="page1Skip" disabled>Next (locked)</button>
          <div class="tiny muted">Tap hearts to fill the meter â€” no skipping!</div>
        </div>
      </div>
    </section>

    <!-- Stage 2 -->
    <section id="page2" class="page">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Stage 2 â€” Catch flowers (25 â†’ 50%)</h1>
        <div class="meter" aria-hidden>
          <div class="meter-bar" id="meter2" style="width:25%"></div>
        </div>
        <div class="flower-area" id="flowerArea" aria-label="catch flowers"></div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center">
          <button class="btn-light" id="page2Letter" disabled>Open Mini Letter</button>
          <div class="tiny muted">Collect flowers to unlock the letter</div>
        </div>
      </div>
    </section>

    <!-- Stage 3 -->
    <section id="page3" class="page">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Stage 3 â€” Follow our tiny path (50 â†’ 75%)</h1>
        <div class="path-area">
          <div class="path-line" id="pathLine" role="img" aria-label="path checkpoints"></div>
        </div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center;margin-top:12px">
          <button class="btn-light" id="openGallery" disabled>View Memory Snaps</button>
          <div class="tiny muted">Tap each checkpoint â€” donâ€™t skip steps, Jayu!</div>
        </div>
      </div>
    </section>

    <!-- Stage 4 -->
    <section id="page4" class="page">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Stage 4 â€” A line-by-line letter (75 â†’ 100%)</h1>
        <div class="meter" aria-hidden>
          <div class="meter-bar" id="meter4" style="width:75%"></div>
        </div>
        <div class="letter-area" id="letterArea">
          <p id="letterTextPreview" class="muted">Tap each tiny heart to reveal the next line of my letter.</p>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px" id="letterHearts"></div>
        </div>
        <div style="display:flex;gap:12px;align-items:center;justify-content:center;margin-top:10px">
          <button class="btn-primary" id="finishLetter" disabled>Open Final Surprise</button>
          <div class="tiny muted">Reveal the full letter to continue</div>
        </div>
      </div>
    </section>

    <section id="pageMap" class="page">
      <div class="stage">
        <h1 style="font-size:30px;font-weight:800">Journey Map â€” Tap each stop</h1>
        <p class="muted">Tap each stop in order. After you answer Stop 5, the future stops will unlock.</p>
        <div class="map-area" id="mapArea" aria-live="polite">
          <!-- past -->
          <div class="map-row locked" data-stop="1" id="stop-1"><div class="map-icon">ğŸ«</div><div><div style="font-weight:700">2005â€“06 â€” GIPCL School, Gujarat</div><div class="muted">Where our story starts</div></div></div>
          <div class="map-row locked" data-stop="2" id="stop-2"><div class="map-icon">ğŸ’¬</div><div><div style="font-weight:700">Bench partners â†’ IG reunion (2017)</div><div class="muted">We reconnected years later</div></div></div>
          <div class="map-row locked" data-stop="3" id="stop-3"><div class="map-icon">ğŸ’—</div><div><div style="font-weight:700">2019 â€” <span id="proposeText">Shubhu proposed first</span></div><div class="muted">My bold baby move</div></div></div>
          <div class="map-row locked" data-stop="4" id="stop-4"><div class="map-icon">ğŸŒ™</div><div><div style="font-weight:700">2019â€“2025 â€” Long distance</div><div class="muted">We waited, we talked, we met in 2025</div></div></div>
          <div class="map-row locked" data-stop="5" id="stop-5"><div class="map-icon">ğŸ“¸</div><div><div style="font-weight:700">Your favourite memory</div><div class="muted">Jayu â€” tell your Shubhu one memory (required)</div></div><div style="margin-left:auto"><button class="btn-light" id="openMemoryBox">Tell memory</button></div></div>

          <div id="futureStops" style="display:none;flex-direction:column;gap:10px;margin-top:8px">
            <div class="map-row locked" data-stop="A" id="stop-A"><div class="map-icon">âœˆï¸</div><div><div style="font-weight:700">Udaipur â€” Our romantic trip</div><div class="muted">A memory in the city of lakes</div></div></div>
            <div class="map-row locked" data-stop="B" id="stop-B"><div class="map-icon">ğŸ¡</div><div><div style="font-weight:700">Our first home</div><div class="muted">A cosy corner full of flowers</div></div></div>
            <div class="map-row locked" data-stop="C" id="stop-C"><div class="map-icon">ğŸ’</div><div><div style="font-weight:700">Wedding</div><div class="muted">Petals and a promise</div></div></div>
            <div class="map-row locked" data-stop="D" id="stop-D"><div class="map-icon">ğŸ‘¶ğŸ¾</div><div><div style="font-weight:700">Babies & pets</div><div class="muted">A warm noisy home (but the quiet parts are cute)</div></div></div>
            <div class="map-row locked" data-stop="E" id="stop-E"><div class="map-icon">ğŸš—</div><div><div style="font-weight:700">Dream car</div><div class="muted">Roadtrips & silly playlists</div></div></div>
            <div class="map-row locked" data-stop="F" id="stop-F"><div class="map-icon">ğŸ®</div><div><div style="font-weight:700">Game room (PS5)</div><div class="muted">Late-night co-op & snacks</div></div></div>
            <div class="map-row locked" data-stop="G" id="stop-G"><div class="map-icon">ğŸ’¼</div><div><div style="font-weight:700">Business together</div><div class="muted">Our little empire</div></div></div>
            <div class="map-row locked" data-stop="H" id="stop-H"><div class="map-icon">ğŸŒ</div><div><div style="font-weight:700">Travel the world</div><div class="muted">Stamp collection, and you stealing my camera</div></div></div>
            <div class="map-row locked" data-stop="K" id="stop-K"><div class="map-icon">ğŸ‘µâ¤ï¸ğŸ‘´</div><div><div style="font-weight:700">Growing old in a big fat family home</div><div class="muted">Lap naps, old jokes, and backyard madness</div></div></div>
          </div>
        </div>

        <div style="display:flex;gap:12px;align-items:center;justify-content:center;margin-top:12px">
          <button class="btn-primary" id="mapFinish" disabled>Finish Journey â†’</button>
          <div class="tiny muted">Complete all stops to finish</div>
        </div>
      </div>
    </section>

    <div id="memoryModal" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal">
        <h3>Jayu â€” your favourite memory</h3>
        <p class="muted tiny">Type one memory you love most. This saves locally on your device.</p>
        <textarea id="memoryInput" rows="4" placeholder="Type your memory..." style="width:100%;border-radius:10px;padding:10px;border:1px solid rgba(0,0,0,0.06)"></textarea>
        <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:10px">
          <button class="btn-light" id="memoryCancel">Cancel</button>
          <button class="btn-primary" id="memorySave">Save memory</button>
        </div>
      </div>
    </div>

    <div id="infoModal" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal">
        <h3 id="infoTitle">Note</h3>
        <div id="infoBody" class="muted" style="margin-top:8px"></div>
        <div style="display:flex;justify-content:flex-end;margin-top:12px">
          <button class="btn-primary" id="infoOk">Okay</button>
        </div>
      </div>
    </div>

    <div id="relocationModal" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal">
        <h3>Relocation â€” a tiny journey animation</h3>
        <p class="muted tiny">A visual map from Jharkhand â†’ Washington DC (visual only)</p>
        <div style="width:100%;height:320px;border-radius:12px;background:linear-gradient(180deg,#fff,#fff6fb);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden">
          <svg viewBox="0 0 100 50" preserveAspectRatio="none" style="width:90%;height:80%">
            <rect x="0" y="0" width="100" height="50" fill="#fffdfd"/>
            <path id="arcPath" d="M10 38 C 35 6, 65 6, 90 38" stroke="rgba(255,110,150,0.18)" stroke-width="1.6" fill="none" stroke-dasharray="2 2"/>
            <circle r="1.6" fill="#ff4f82">
              <animateMotion begin="0s" dur="4.4s" repeatCount="1" fill="freeze"><mpath xlink:href="#arcPath" /></animateMotion>
            </circle>
            <circle cx="10" cy="38" r="2.2" fill="#ff7aa5"/>
            <circle cx="90" cy="38" r="2.2" fill="#ff7aa5"/>
          </svg>
        </div>
        <div style="display:flex;justify-content:flex-end;margin-top:10px">
          <button class="btn-light" id="relocClose">Close</button>
        </div>
      </div>
    </div>

    <!-- Gallery modal: NOW SHOWS MESSAGES (no photos) -->
    <div id="galleryModal" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal" style="max-width:980px">
        <h3>Memory Snaps</h3>
        <div id="galleryLoader" style="display:block;text-align:center">
          <div class="spinner" aria-hidden="true"></div>
          <div class="muted tiny">Preparing sweet notesâ€¦</div>
        </div>

        <div id="galleryBody" style="display:none">
          <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
            <div style="display:flex;gap:14px;align-items:flex-start">
              <div class="gallery-message" id="slideMsg1" role="img" aria-label="message slide 1"></div>
              <div class="gallery-message small" id="slideMsg2" role="img" aria-label="message slide 2" style="display:none"></div>
            </div>

            <div style="display:flex;flex-direction:column;gap:10px;align-items:center">
              <div style="display:flex;gap:8px">
                <button class="btn-light" id="prevSlide">Prev</button>
                <button class="btn-light" id="nextSlide">Next</button>
              </div>
              <div class="tiny muted">Auto-advances â€” but you can control it</div>
            </div>
          </div>

          <div style="display:flex;justify-content:flex-end;margin-top:12px">
            <button class="btn-light" id="galleryClose">Close</button>
          </div>
        </div>
      </div>
    </div>

    <section id="pageFinal" class="page">
      <div class="stage" style="align-items:center;justify-content:center">
        <h1 style="font-size:32px;font-weight:800">Close your eyes and smile, Jayuâ€¦</h1>
        <p class="muted" style="max-width:720px;text-align:center">Imagine every version of us â€” school kids, long-distance fools, and old home-makers â€” and smile. In every timeline, I choose you.</p>
        <div class="big-heart" id="bigHeart" aria-hidden="true"></div>
        <div style="margin-top:10px"><button class="btn-primary" id="hugBtn">Hug Shubhu ğŸ¤</button></div>
      </div>
    </section>

    <footer>Made with love by <strong id="footerShubhu">Shubhu</strong> ğŸ’—</footer>
  </div>

<script>
/* helper */
const $ = (id) => document.getElementById(id);

/* nicknames */
if($('nick-jayu')) $('nick-jayu').textContent = (typeof NICK_JAYU !== 'undefined') ? NICK_JAYU : "Jayu";
if($('nick-shubhu')) $('nick-shubhu').textContent = (typeof NICK_SHUBHU !== 'undefined') ? NICK_SHUBHU : "Shubhu";
if($('nick-shubhu-inline')) $('nick-shubhu-inline').textContent = (typeof NICK_SHUBHU !== 'undefined') ? NICK_SHUBHU : "Shubhu";
if($('footerShubhu')) $('footerShubhu').textContent = (typeof NICK_SHUBHU !== 'undefined') ? NICK_SHUBHU : "Shubhu";

/* Info modal */
function showInfoModal(title, body, cb){
  const modal = $('infoModal'); if(!modal) return;
  const titleEl = $('infoTitle'), bodyEl = $('infoBody'), ok = $('infoOk');
  if(titleEl) titleEl.textContent = title;
  if(bodyEl) bodyEl.textContent = body;
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden','false');
  if(ok){
    ok.onclick = ()=> { modal.style.display='none'; modal.setAttribute('aria-hidden','true'); if(cb) cb(); };
    ok.focus && ok.focus();
  }
}

/* floating hearts */
(function populateFloatingHearts(){
  try{
    const wrap = $('floatingHeartBg'); if(!wrap) return;
    wrap.innerHTML = '';
    const icons = ['ğŸ’—','ğŸ’–','ğŸ’•'];
    for(let i=0;i<22;i++){
      const d=document.createElement('div'); d.className='fh'; d.textContent = icons[Math.floor(Math.random()*icons.length)];
      d.style.left = (5 + Math.random()*90) + '%'; d.style.top = (60 + Math.random()*30) + '%';
      d.style.animationDuration = (18 + Math.random()*26).toFixed(1) + 's'; d.style.animationDelay = (Math.random()*8).toFixed(1) + 's';
      d.style.fontSize = (18 + Math.random()*30) + 'px'; wrap.appendChild(d);
    }
  }catch(e){console.warn('hearts',e)}
})();

/* welcome */
if($('welcomeAccept')) $('welcomeAccept').addEventListener('click', ()=> { const wm=$('welcomeModal'); if(wm){ wm.style.display='none'; wm.setAttribute('aria-hidden','true'); } });

/* Stage 1 */
const meter1 = $('meter1'), heartsArea = $('heartsArea');
let progress1 = 0, target1 = 25;
function createHearts(){
  if(!heartsArea) return;
  heartsArea.innerHTML = '';
  for(let i=0;i<12;i++){
    const d=document.createElement('div'); d.className='heart'; d.textContent='ğŸ’—';
    d.addEventListener('click', ()=> {
      if(progress1 >= target1) return;
      progress1 += Math.floor(Math.random()*3)+1;
      if(progress1>target1) progress1 = target1;
      if(meter1) meter1.style.width = progress1 + '%';
      d.style.transform='scale(.96) translateY(2px)';
      setTimeout(()=> d.style.transform='',120);
      const btn = $('page1Skip');
      if(progress1 >= target1 && btn){ btn.disabled = false; btn.onclick = ()=> { showPage('page2'); btn.disabled = true; } }
    });
    heartsArea.appendChild(d);
  }
}
createHearts();

/* Stage 2: Flowers with auto-open */
const flowerArea = $('flowerArea');
let progress2 = 25, target2 = 50, miniLetterOpened = false;
function createFlowers(){
  if(!flowerArea) return;
  flowerArea.innerHTML = '';
  const tileCount = 18;
  for(let i=0;i<tileCount;i++){
    const f=document.createElement('div'); f.className='flower';
    const icons = ['ğŸŒ¸','âš½','ğŸ®','ğŸš—']; f.textContent = icons[Math.floor(Math.random()*icons.length)];
    f.addEventListener('click', ()=>{
      if(progress2 >= target2) return;
      progress2 += 2;
      if(progress2>target2) progress2 = target2;
      f.classList.add('collected');
      const m2 = $('meter2'); if(m2) m2.style.width = progress2 + '%';
      checkStage2();
    });
    flowerArea.appendChild(f);
  }
}
function checkStage2(){
  const btn = $('page2Letter');
  if(progress2 >= target2){
    if(btn){
      btn.disabled = false;
      if(!btn._attached){
        btn._attached = true;
        btn.addEventListener('click', ()=> {
          showInfoModal("Mini letter from " + (typeof NICK_SHUBHU!=='undefined'?NICK_SHUBHU:'Shubhu'),
                        "Halfway, and I kept choosing you.",
                        ()=> showPage('page3'));
        });
      }
      try{ btn.focus(); }catch(e){}
    }

    if(!miniLetterOpened){
      miniLetterOpened = true;
      document.querySelectorAll('.flower').forEach(fl => { fl.classList.add('collected'); fl.style.pointerEvents='none'; });
      setTimeout(()=> {
        showInfoModal("Mini letter from " + (typeof NICK_SHUBHU!=='undefined'?NICK_SHUBHU:'Shubhu'),
                      "Halfway, and I kept choosing you.",
                      ()=> showPage('page3'));
      }, 240);
    }
  } else {
    if(btn) btn.disabled = true;
  }
}
createFlowers();

/* Stage 3 path */
const pathLine = $('pathLine');
let checkpointCount = 0;
const checkpoints = [
  {x:8, label:"We learned to trust."},
  {x:30, label:"We learned to stay."},
  {x:54, label:"We learned to love deeper."},
  {x:80, label:"We chose each other."}
];
function buildPath(){
  if(!pathLine) return;
  pathLine.innerHTML = '';
  checkpoints.forEach((cp,i)=>{
    const el=document.createElement('div'); el.className='checkpoint locked'; el.style.left = cp.x + '%'; el.id = 'cp-'+i;
    el.setAttribute('tabindex','0');
    el.innerHTML = `<div style="font-weight:700">â€¢</div><div class="muted tiny">${cp.label}</div>`;
    el.addEventListener('click', ()=>{
      if(i>checkpointCount){ showInfoModal("Slow down, Jayu","Follow the path in order â€” one step at a time ğŸ˜Š"); return; }
      el.classList.remove('locked'); el.classList.add('unlocked');
      showInfoModal("Memory unlocked", cp.label);
      checkpointCount++;
      const percent = 50 + Math.floor((checkpointCount/checkpoints.length)*25);
      const m2 = $('meter2'); if(m2) m2.style.width = percent + '%';
      if(checkpointCount === checkpoints.length){
        const openG = $('openGallery');
        if(openG){
          openG.disabled = false;
          openG.addEventListener('click', openGalleryWithLoader, {once:true});
        }
      }
    });
    pathLine.appendChild(el);
  });
}
buildPath();

/* Stage 4: letter */
const letterLines = [
  "Even when the world was loud,",
  "I kept hearing your quiet laugh.",
  "Even when miles stretched long,",
  "You were the place I came home to.",
  "You are my calm and my chaos.",
  "I choose you â€” again and again."
];
let revealed = 0;
const letterHearts = $('letterHearts');
function buildLetterHearts(){
  if(!letterHearts) return;
  letterHearts.innerHTML = '';
  for(let i=0;i<letterLines.length;i++){
    const h=document.createElement('div'); h.className='heart'; h.textContent='ğŸ’—';
    h.addEventListener('click', ()=>{
      if(h.dataset.revealed==='true') return;
      showInfoModal("Letter line", letterLines[i], ()=>{
        const p=document.createElement('div'); p.style.marginTop='8px'; p.style.fontWeight='600'; p.textContent = letterLines[i];
        const area = $('letterArea'); if(area) area.insertBefore(p, letterHearts);
        h.dataset.revealed='true'; revealed++;
        const m4 = $('meter4'); const percent = 75 + Math.floor((revealed/letterLines.length)*25);
        if(m4) m4.style.width = percent + '%';
        if(revealed === letterLines.length){
          const finish = $('finishLetter'); if(finish){ finish.disabled = false; finish.onclick = ()=> { showPage('pageMap'); unlockMapStop(1); } }
        }
      });
    });
    letterHearts.appendChild(h);
  }
}
buildLetterHearts();

/* Journey map unlocks */
function unlockMapStop(n){
  let el = null;
  if(typeof n === 'number' && n>0 && n<=5) el = $('stop-'+n);
  else el = document.querySelector(`[data-stop='${n}']`);
  if(!el) return; el.classList.remove('locked'); el.classList.add('unlocked');
}
['stop-1','stop-2','stop-3','stop-4'].forEach(id=>{
  const el = $(id); if(!el) return;
  el.addEventListener('click', ()=> {
    if(el.classList.contains('locked')){ showInfoModal("Locked","Complete previous steps to unlock this stop, Jayu."); return; }
    const title = el.querySelector('div[style*="font-weight:700"]') ? el.querySelector('div[style*="font-weight:700"]').textContent : '';
    const body = el.querySelector('.muted') ? el.querySelector('.muted').textContent : '';
    showInfoModal(title, body, ()=> { const next = parseInt(id.split('-')[1]) + 1; if($('stop-'+next)) unlockMapStop(next); });
  });
});

/* Stop 5 memory box */
if($('openMemoryBox')) $('openMemoryBox').addEventListener('click', ()=> { const mm = $('memoryModal'); if(!mm) return; mm.style.display='flex'; mm.setAttribute('aria-hidden','false'); const saved = localStorage.getItem('favMemory'); if(saved && $('memoryInput')) $('memoryInput').value = saved; });
if($('memoryCancel')) $('memoryCancel').addEventListener('click', ()=> { const mm=$('memoryModal'); if(mm){ mm.style.display='none'; mm.setAttribute('aria-hidden','true'); }});
if($('memorySave')) $('memorySave').addEventListener('click', ()=> {
  const el = $('memoryInput'); if(!el) return; const val = el.value.trim();
  if(!val){ showInfoModal("Aww","Please share one memory, Jayu â€” your Shubhu is waiting!"); return; }
  localStorage.setItem('favMemory', val);
  const mm = $('memoryModal'); if(mm){ mm.style.display='none'; mm.setAttribute('aria-hidden','true'); }
  showInfoModal("Saved","Memory saved. Thank you, Jayu ğŸ’—", ()=> { const future = $('futureStops'); if(future) future.style.display = 'flex'; unlockFutureStopsInOrder(0); });
});

/* future stops unlocking */
const futureList = ['A','B','C','D','E','F','G','H','K'];
function unlockFutureStopsInOrder(idx){
  if(idx >= futureList.length){ const mf=$('mapFinish'); if(mf) mf.disabled=false; return; }
  const code = futureList[idx]; const el = document.querySelector(`[data-stop='${code}']`); if(!el) return;
  el.classList.remove('locked'); el.classList.add('unlocked');
  el.onclick = ()=> {
    if(code==='C'){ const rm=$('relocationModal'); if(rm){ rm.style.display='flex'; rm.setAttribute('aria-hidden','false'); const rc=$('relocClose'); if(rc) rc.onclick = ()=> { rm.style.display='none'; rm.setAttribute('aria-hidden','true'); } } }
    if(code==='A'){ showInfoModal("Udaipur","A gentle memory appears."); }
    el.classList.add('unlocked');
    unlockFutureStopsInOrder(idx+1);
  };
}
if($('mapFinish')) $('mapFinish').addEventListener('click', ()=> { showInfoModal("Journey complete","You completed the journey, Jayu. One last surprise awaits.", ()=> showPage('pageFinal')); });

/* ============ Gallery (MESSAGES only) ============ */
let slideshowTimer = null;
let currentSlide = 0;
let slidesMessages = []; // will be prepared on open

function openGalleryWithLoader(){
  const gm = $('galleryModal'); if(!gm) return;
  gm.style.display = 'flex'; gm.setAttribute('aria-hidden','false');
  const loader = $('galleryLoader'), body = $('galleryBody');
  if(loader) loader.style.display = 'block';
  if(body) body.style.display = 'none';

  // prepare messages: include user-saved memory if present (favMemory), plus default cute notes
  const saved = localStorage.getItem('favMemory');
  slidesMessages = [];
  if(saved) slidesMessages.push("Your favourite memory: " + saved);
  slidesMessages = slidesMessages.concat([
    "I like the way you laugh when Iâ€™m being dramatic.",
    "You are my calm in the noisy world â€” and my favourite chaos.",
    "Tiny promise: more hugs, more silly playlists, more us.",
    "No matter how many miles â€” I pick you every time."
  ]);
  slidesMessages = slidesMessages.slice(0,6);

  setTimeout(()=>{
    // populate message slides
    const s1 = $('slideMsg1'), s2 = $('slideMsg2');
    if(s1) s1.textContent = slidesMessages[0] || "You are my favourite.";
    if(s2) {
      if(slidesMessages.length > 1) { s2.style.display = 'block'; s2.textContent = slidesMessages[1]; } 
      else { s2.style.display = 'none'; }
    }
    if(loader) loader.style.display = 'none';
    if(body) body.style.display = 'block';
    // start slideshow only if we have at least 1 message
    startSlideshow();
    spawnSparkles('sparkContainer'); spawnSparkles('sparkContainer2');
  }, 450);
}

function startSlideshow(){
  if(!slidesMessages.length) return;
  currentSlide = 0; updateSlide();
  if(slideshowTimer) clearInterval(slideshowTimer);
  slideshowTimer = setInterval(()=> {
    currentSlide = (currentSlide + 1) % slidesMessages.length;
    updateSlide();
  }, 4200);
}
function stopSlideshow(){ if(slideshowTimer){ clearInterval(slideshowTimer); slideshowTimer = null; } }

function updateSlide(){
  const s1 = $('slideMsg1'), s2 = $('slideMsg2');
  if(!s1) return;
  if(slidesMessages.length === 1){
    s1.textContent = slidesMessages[0];
    if(s2) s2.style.display='none';
  } else {
    const idx1 = currentSlide;
    const idx2 = (currentSlide + 1) % slidesMessages.length;
    s1.textContent = slidesMessages[idx1];
    if(s2) { s2.textContent = slidesMessages[idx2]; s2.style.display='block'; }
    if(s2){
      if(currentSlide % 2 === 0){ s1.style.opacity = 1; s2.style.opacity = 0.28; }
      else { s1.style.opacity = 0.28; s2.style.opacity = 1; }
    }
  }
}

/* Prev/Next buttons (manual control) */
if($('prevSlide')) $('prevSlide').addEventListener('click', ()=> {
  stopSlideshow();
  if(!slidesMessages.length) return;
  currentSlide = (currentSlide - 1 + slidesMessages.length) % slidesMessages.length;
  updateSlide();
});
if($('nextSlide')) $('nextSlide').addEventListener('click', ()=> {
  stopSlideshow();
  if(!slidesMessages.length) return;
  currentSlide = (currentSlide + 1) % slidesMessages.length;
  updateSlide();
});

/* Sparkles for gallery */
function spawnSparkles(containerId){
  const container = $(containerId); if(!container) return;
  container.innerHTML = '';
  for(let i=0;i<6;i++){
    const d=document.createElement('div'); d.className='sparkle-dot';
    d.style.left=(8 + Math.random()*82)+'%'; d.style.top=(8 + Math.random()*72)+'%';
    d.style.animationDelay=(Math.random()*2)+'s'; container.appendChild(d);
  }
}

/* ----- UPDATED: galleryClose handler (auto-advance to Stage 4) ----- */
if ($('galleryClose')) {
  $('galleryClose').addEventListener('click', () => {
    const gm = $('galleryModal');
    if (gm) {
      gm.style.display = 'none';
      gm.setAttribute('aria-hidden', 'true');
    }
    stopSlideshow();

    // small delay so the modal hide feels smooth, then advance to Stage 4
    setTimeout(() => {
      showPage('page4');
    }, 220);
  });
}

/* relocation close */
if($('relocClose')) $('relocClose').addEventListener('click', ()=> { const rm=$('relocationModal'); if(rm){ rm.style.display='none'; rm.setAttribute('aria-hidden','true'); } });

/* hug */
if($('hugBtn')) $('hugBtn').addEventListener('click', ()=> { const b=$('bigHeart'); if(!b) return; b.classList.add('expand'); setTimeout(()=> b.classList.remove('expand'),1600); });

/* page switcher */
function showPage(id){
  document.querySelectorAll('.page').forEach(p=> p.classList.remove('active'));
  const node = $(id); if(node){ node.classList.add('active'); node.scrollIntoView({behavior:'smooth'}); }
  window.scrollTo({top:0,behavior:'smooth'});
}

/* escape closes */
document.addEventListener('keydown',(e)=>{ if(e.key==='Escape'){ ['infoModal','memoryModal','galleryModal','relocationModal','welcomeModal'].forEach(id=>{ const el=$(id); if(el){ el.style.display='none'; el.setAttribute('aria-hidden','true'); } }); stopSlideshow(); }});

/* initial sync */
window.addEventListener('load', ()=>{
  if($('meter1')) $('meter1').style.width = (progress1)+'%';
  if($('meter2')) $('meter2').style.width = (progress2)+'%';
  if($('meter4')) { const m4 = 75 + Math.floor((revealed/letterLines.length)*25); $('meter4').style.width = (revealed ? m4 + '%' : '75%'); }
});
</script>
</body>
</html>
